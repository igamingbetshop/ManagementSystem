<div class="container">
  <div class="content-action">
    <div class="title">{{'Dashboard.Dashboard' | translate}}</div>
    <div class="custom-dropdown">
      <mat-select
        (selectionChange)="onPartnerChange($event.value)"
        placeholder="{{'Partners.SelectPartner' | translate}}"
        panelClass="overlay-dropdown"
        disableOptionCentering>
        <mat-option [value]="null">{{'Partners.SelectPartner' | translate}}</mat-option>
        <mat-option *ngFor="let partner of partners" [value]="partner.Id">{{partner.Name}}</mat-option>
      </mat-select>
    </div>
    <div class="date-time-tabs">
      <button class="tab-btn" [class.selected-time]="selectedItem ==='All Times'" mat-stroked-button (click)="selectTime('All Times')">{{'Common.AllTimes' | translate}}</button>
      <button class="tab-btn" [class.selected-time]="selectedItem === 'month'" mat-stroked-button (click)="selectTime('month')">{{'Common.Month' | translate}}</button>
      <button class="tab-btn" [class.selected-time]="selectedItem === 'week'" mat-stroked-button (click)="selectTime('week')">{{'Common.Week' | translate}}</button>
      <button class="tab-btn" [class.selected-time]="selectedItem === 'yesterday'" mat-stroked-button (click)="selectTime('yesterday')">{{'Common.Yesterday' | translate}}</button>
      <button class="tab-btn" [class.selected-time]="selectedItem === 'today'" mat-stroked-button (click)="selectTime('today')">{{'Common.Today' | translate}}</button>
    </div>

    <mat-form-field class="calendar-picker start" appearance="none">
      <input matInput [ngxMatDatetimePicker]="pickerStart" [(ngModel)]="fromDate" (dateChange)="onStartDateChange($event)">
      <mat-datepicker-toggle matSuffix [for]="pickerStart">
        <div matDatepickerToggleIcon class="icon-calendar" aria-hidden="true" data-icon="&#xe909;"></div>
      </mat-datepicker-toggle>
      <ngx-mat-datetime-picker #pickerStart></ngx-mat-datetime-picker>
    </mat-form-field>

    <mat-form-field class="calendar-picker" appearance="none">
      <input matInput [ngxMatDatetimePicker]="pickerEnd" [(ngModel)]="toDate" (dateChange)="onEndDateChange($event)">
      <mat-datepicker-toggle matSuffix [for]="pickerEnd">
        <div matDatepickerToggleIcon class="icon-calendar" aria-hidden="true" data-icon="&#xe909;"></div>
      </mat-datepicker-toggle>
      <ngx-mat-datetime-picker #pickerEnd></ngx-mat-datetime-picker>
    </mat-form-field>

    <button mat-stroked-button class="mat-btn" (click)="onCalendarFilter()">{{'Common.Go' | translate}}</button>
  </div>

  <div class="chart-grid">
    <div class="cart">
      <div class="chart-action">
        <div class="chart-view-action">
          <mat-icon (click)="changeGraff(-1)">keyboard_arrow_left</mat-icon>
          <div class="dash-text">{{ selectedGridName | translate }}</div>
          <mat-icon (click)="changeGraff(1)">keyboard_arrow_right</mat-icon>
        </div>

        <div class="custom-dropdown">
          <mat-select
            (selectionChange)="changeCartType($event.value)"
            placeholder="{{'Bonuses.SelectType' | translate}}"
            panelClass="overlay-dropdown"
            disableOptionCentering>
            <mat-option *ngFor="let cartType of cartTypes" [value]="cartType.value">{{cartType.id | translate}}</mat-option>
          </mat-select>
        </div>

        <div class="custom-dropdown" *ngIf="selectedGrid === 1 || selectedGrid === 2">
          <mat-select
            (selectionChange)="onStateChange($event.value)"
            placeholder="{{'Common.SelectState' | translate}}"
            panelClass="overlay-dropdown multiple"
            disableOptionCentering multiple>
            <mat-option *ngFor="let state of paymentStates" [value]="state.Id">{{state.Name}}</mat-option>
          </mat-select>
        </div>
      </div>
      <div class="chart-content" [chart]="chart"></div>
    </div>

    <div class="players-info pointer" [ngClass]="{'select-grid': selectedGrid === 3}" (click)="selectGrid(3)">
      <div class="dashboard-panel">
        <h2>{{'Dashboard.Players' | translate}}</h2>
        <div class="panel-scroller">
          <div class="panel-row"><strong># {{'Dashboard.Visitors' | translate}}</strong><br/>{{playersInfo?.VisitorsCount}}</div>
          <div class="panel-row">
            <strong># {{'Dashboard.SignUps' | translate}}</strong><br/>{{playersInfo?.SignUpsCount}}
          </div>
          <div class="panel-row">
            <strong># {{'Dashboard.Returns' | translate}}</strong><br/>{{playersInfo?.ReturnsCount}}
          </div>
          <div class="panel-row">
            <strong>{{'Dashboard.Bonuses' | translate}}</strong><br/>{{playersInfo?.TotalBonusAmount | number:'1.2-2'}}
          </div>
          <div class="panel-row">
            <strong>{{'Dashboard.Cashout' | translate}}</strong><br/>{{playersInfo?.TotalCashoutAmount | number:'1.2-2'}}
          </div>
          <div class="panel-row"><strong>{{'Dashboard.AverageBet' | translate}}</strong><br/>{{playersInfo?.AverageBet | number:'1.2-2'}}</div>
          <div class="panel-row"><strong>{{'Dashboard.MaxBet' | translate}}</strong><br/>{{playersInfo?.MaxBet | number:'1.2-2'}}</div>
          <div class="panel-row">
            <strong>{{'Dashboard.MaxWin' | translate}}</strong><br/>{{playersInfo?.MaxWin | number:'1.2-2'}}
            <span class="max-win-bet">{{playersInfo?.MaxWinBet | number:'1.2-2'}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="chart-grid">
    <div class="info pointer" [ngClass]="{'select-grid': selectedGrid === 0}" (click)="selectGrid(0)">
      <div class="dashboard-panel">
        <h2>{{'Dashboard.PlacedBets' | translate}}</h2>
        <table class="table dashboard-header-table">
          <tr>
            <th></th>
            <th>{{'Dashboard.Amount' | translate}}</th>
            <th>{{'Dashboard.GGR' | translate}}</th>
            <th>{{'Dashboard.NGR' | translate}}</th>
            <th>{{'Partners.Count' | translate}}</th>
            <th>{{'Dashboard.Players' | translate}}</th>
          </tr>
        </table>
        <div class="table-content">
          <table class="table pointer">
          <tbody>
          <tr>
            <td>{{'Dashboard.AllBets' | translate}}</td>
            <td>{{betsInfo?.TotalBetsAmount | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalGGR | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalNGR | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalBetsCount}}</td>
            <td>{{betsInfo?.TotalPlayersCount}}</td>
          </tr>
          <tr>
            <td>{{'Dashboard.MobileBets' | translate}}</td>
            <td>{{betsInfo?.TotalBetsFromMobile | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalGGRFromMobile | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalNGRFromMobile | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalBetsCountFromMobile}}</td>
            <td>{{betsInfo?.TotalPlayersCountFromMobile}}</td>
          </tr>
          <tr>
            <td>{{'Dashboard.WebsiteBets' | translate}}</td>
            <td>{{betsInfo?.TotalBetsFromWebSite | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalGGRFromWebSite | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalNGRFromWebSite | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalBetsCountFromWebSite}}</td>
            <td>{{betsInfo?.TotalPlayersCountFromWebSite}}</td>
          </tr>
          <tr>
            <td>{{'Dashboard.WapBets' | translate}}</td>
            <td>{{betsInfo?.TotalBetsFromWap | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalGGRFromWap | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalNGRFromWap | number:'1.2-2'}}</td>
            <td>{{betsInfo?.TotalBetsCountFromWap}}</td>
            <td>{{betsInfo?.TotalPlayersCountFromWap}}</td>
          </tr>
          </tbody>
        </table>
        </div>
      </div>
    </div>
    <div class="info pointer" [ngClass]="{'select-grid': selectedGrid === 1}" (click)="selectGrid(1)">
      <div class="dashboard-panel">
        <h2>{{'Dashboard.Deposits' | translate}}</h2>
        <table class="table dashboard-header-table">
          <tr>
            <th>{{'Dashboard.StatusMethod' | translate}}</th>
            <th>{{'Dashboard.Amount' | translate}}</th>
            <th>{{'Partners.Count' | translate}}</th>
            <th>{{'Dashboard.Players' | translate}}</th>
          </tr>
        </table>

        <div class="table-content">
          <table class="table pointer">
            <tbody *ngFor="let key of deposits">
            <tr class="status-text status-text bolded-row">
              <td>{{key.key}}</td>
              <td>{{key.totals?.TotalAmount | number:'1.2-2'}}</td>
              <td>{{key.totals?.TotalDepositsCount }}</td>
              <td>{{key.totals?.TotalPlayersCount}}</td>
            </tr>
            <tr class="status-text status-text soft-row" *ngFor="let item of key.pSystems">
              <td>{{item.PaymentSystemName}}</td>
              <td>{{item.TotalAmount | number:'1.2-2'}}</td>
              <td>{{item.TotalDepositsCount }}</td>
              <td>{{item.TotalPlayersCount}}</td>
            </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
    <div class="info pointer" [ngClass]="{'select-grid': selectedGrid === 1}" (click)="selectGrid(1)">
      <div class="dashboard-panel">
        <h2>{{'Dashboard.Withdrawals' | translate}}</h2>
        <table class="table dashboard-header-table">
          <tr>
            <th>{{'Dashboard.StatusMethod' | translate}}</th>
            <th>{{'Dashboard.Amount' | translate}}</th>
            <th>{{'Partners.Count' | translate}}</th>
            <th>{{'Dashboard.Players' | translate}}</th>
          </tr>
        </table>

        <div class="table-content">
          <table class="table pointer">
            <tbody *ngFor="let key of withdrawals">
            <tr class="status-text status-text bolded-row">
              <td>{{key.key}}</td>
              <td>{{key.totals?.TotalAmount | number:'1.2-2'}}</td>
              <td>{{key.totals?.TotalWithdrawalsCount }}</td>
              <td>{{key.totals?.TotalPlayersCount}}</td>
            </tr>
            <tr class="status-text status-text soft-row" *ngFor="let item of key.pSystems">
              <td>{{item.PaymentSystemName}}</td>
              <td>{{item.TotalAmount | number:'1.2-2'}}</td>
              <td>{{item.TotalWithdrawalsCount }}</td>
              <td>{{item.TotalPlayersCount}}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="chart-grid">
    <div class="info pointer" [ngClass]="{'select-grid': selectedGrid === 4}" (click)="selectGrid(4)">
      <div class="dashboard-panel">
        <h2>{{'Dashboard.BetsByProviders' | translate}}</h2>
        <table class="table dashboard-header-table">
          <tr>
            <th>{{'Dashboard.Provider' | translate}}</th>
            <th>{{'Dashboard.TotalBets' | translate}}</th>
            <th>{{'Dashboard.TotalWin' | translate}}</th>
            <th>#{{'Dashboard.Bets' | translate}}</th>
            <th>{{'Dashboard.TotalGGR' | translate}}</th>
            <th>{{'Dashboard.TotalNGR' | translate}}</th>
            <th>{{'Dashboard.UniquePlayers' | translate}}</th>
            <th>{{'Dashboard.Internet' | translate}}</th>
            <th>{{'Dashboard.LandBased' | translate}}</th>
          </tr>
        </table>
        <div class="table-content">
          <table class="table pointer provider">
          <tbody>
          <tr *ngFor="let bet of providerBets">
            <td>{{bet.ProviderName}}</td>
            <td [ngClass]="{'positive': bet.TotalBetsAmount >= 0, 'negative': bet.TotalBetsAmount < 0}">
              {{bet.TotalBetsAmount | number:'1.2-2'}} /
              <span>{{bet.TotalBetsAmount / pbt.TotalBetsAmount | percent:'2.1'}}</span>
            </td>
            <td [ngClass]="{'positive': bet.TotalWinsAmount >= 0, 'negative': bet.TotalWinsAmount < 0}">
              {{bet.TotalWinsAmount | number:'1.2-2'}} /
              <span>{{bet.TotalWinsAmount / pbt.TotalWinsAmount | percent:'2.1'}}</span>
            </td>
            <td>{{bet.TotalBetsCount}}</td>
            <td [ngClass]="{'positive': bet.TotalGGR >= 0, 'negative': bet.TotalGGR < 0}">
              {{bet.TotalGGR | number:'1.2-2'}} /
              <span>{{bet.TotalGGR / pbt.TotalGGR | percent:'2.1'}}</span>
            </td>
            <td>{{bet.TotalNGR | number:'1.2-2'}}</td>

            <td>{{bet.TotalPlayersCount}}</td>
            <td
              [ngClass]="{'positive': bet.TotalBetsAmountFromInternet >= 0, 'negative': bet.TotalBetsAmountFromInternet < 0}">
              {{bet.TotalBetsAmountFromInternet | number:'1.2-2'}}/
              <span>{{bet.TotalBetsAmountFromInternet / bet.TotalBetsAmount | percent:'2.1'}}</span>
            </td>
            <td
              [ngClass]="{'positive': bet.TotalBetsAmountFromBetShop >= 0, 'negative': bet.TotalBetsAmountFromBetShop < 0}">
              {{bet.TotalBetsAmountFromBetShop | number:'1.2-2'}}/
              <span>{{bet.TotalBetsAmountFromBetShop / bet.TotalBetsAmount | percent:'2.1'}}</span>
            </td>
          </tr>
          <tr>
            <td>{{pbt?.ProviderName}}</td>
            <td [ngClass]="{'positive': pbt?.TotalBetsAmount >= 0, 'negative': pbt?.TotalBetsAmount < 0}">
              {{pbt?.TotalBetsAmount | number:'1.2-2'}}/
              <span>{{1 | percent:'2.1'}}</span>
            </td>
            <td [ngClass]="{'positive': pbt?.TotalWinsAmount >= 0, 'negative': pbt?.TotalWinsAmount < 0}">
              {{pbt?.TotalWinsAmount | number:'1.2-2'}}/
              <span>{{1 | percent:'2.1'}}</span>
            </td>
            <td>{{pbt?.TotalBetsCount}}</td>
            <td [ngClass]="{'positive': pbt?.TotalGGR >= 0, 'negative': pbt?.TotalGGR < 0}">
              {{pbt?.TotalGGR | number:'1.2-2'}}/
              <span>{{1 | percent:'2.1'}}</span>
            </td>
            <td>{{pbt?.TotalNGR | number:'1.2-2'}}</td>

            <td>{{pbt?.TotalPlayersCount}}</td>
            <td
              [ngClass]="{'positive': pbt?.TotalBetsAmountFromInternet >= 0, 'negative': pbt?.TotalBetsAmountFromInternet < 0}">
              {{pbt?.TotalBetsAmountFromInternet | number:'1.2-2'}}/
              <span>{{pbt?.TotalBetsAmountFromInternet / pbt?.TotalBetsAmount | percent:'2.1'}}</span>
            </td>
            <td
              [ngClass]="{'positive': pbt?.TotalBetsAmountFromBetShop >= 0, 'negative': pbt?.TotalBetsAmountFromBetShop < 0}">
              {{pbt?.TotalBetsAmountFromBetShop | number:'1.2-2'}}/
              <span>{{pbt?.TotalBetsAmountFromBetShop / pbt?.TotalBetsAmount | percent:'2.1'}}</span>
            </td>
          </tr>
          </tbody>
        </table>
        </div>
      </div>
    </div>
  </div>
</div>

