<div mat-dialog-title>
  <span class="title">{{'Bonuses.GeneralSetup' | translate}}</span>
  <mat-icon alt="icon" class="icon" (click)="close()">close</mat-icon>
</div>

<div class="modal-wrap">
  <form class="modal-form" [formGroup]="formGroup">

    <mat-form-field>
      <mat-label>{{'Bonuses.SelectType' | translate}}</mat-label>
      <mat-select placeholder="{{'Bonuses.SelectType' | translate}}" [formControlName]="'BonusTypeId'"
        (selectionChange)="onBonusChange($event.value)" required>
        @for (name of bonusTypes; track $index) {
        <mat-option [value]="name.Id">{{name.Name}}</mat-option>
        }
      </mat-select>
      @if(errorControl['BonusTypeId']?.touched && errorControl['BonusTypeId'].errors?.required) {
      <mat-error>
        {{'Bonuses.SelectType' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
    </mat-form-field>

    <mat-form-field>
      <mat-label>{{'Partners.SelectPartner' | translate}}</mat-label>
      <mat-select placeholder="{{'Partners.SelectPartner' | translate}}" [formControlName]="'PartnerId'" required>
        @for (name of partners; track $index) {
        <mat-option [value]="name.Id">{{name.Name}}</mat-option>
        }
      </mat-select>
      @if(errorControl['PartnerId']?.touched && errorControl['PartnerId'].errors?.required) {
      <mat-error>
        {{'Partners.SelectPartner' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
    </mat-form-field>

    @if(bonusTypeId == 10 || bonusTypeId == 13 || bonusTypeId == 4) {
    <mat-form-field>
      <mat-label>{{'Bonuses.WinAccountType' | translate}}</mat-label>
      <mat-select [formControlName]="'WinAccountTypeId'">
        @for (name of clientType; track $index) {
        <mat-option [value]="name.Id">{{name.Name}}</mat-option>
        }
      </mat-select>
      @if(errorControl['WinAccountTypeId']?.touched && errorControl['WinAccountTypeId'].errors?.required) {
      <mat-error>
        {{'Bonuses.SelectAccountType' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
    </mat-form-field>
    }

    @if(bonusTypeId != 14) {
    <mat-form-field>
      <mat-label>{{'Bonuses.FinalAccountType' | translate}}</mat-label>
      <mat-select [formControlName]="'FinalAccountTypeId'">
        @for (name of finalAccountTypes; track $index) {
        <mat-option [value]="name.Id">{{name.Name}}</mat-option>
        }
      </mat-select>
      @if(errorControl['FinalAccountTypeId']?.touched && errorControl['FinalAccountTypeId'].errors?.required) {
      <mat-error>
        {{'Bonuses.SelectAccountType' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
    </mat-form-field>
    }

    <mat-form-field>
      <mat-label>{{'Common.Name' | translate}}</mat-label>
      <input matInput type="text" [placeholder]="'Common.Name' | translate" [formControlName]="'Name'" required>
      @if(errorControl['Name']?.touched && errorControl['Name'].errors?.required) {
      <mat-error>
        {{'Common.Name' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
    </mat-form-field>

    @if(bonusTypeId == 10 || bonusTypeId == 13 || bonusTypeId == 11 || bonusTypeId == 12 || bonusTypeId == 14 || bonusTypeId == 4) {

    @if(bonusTypeId != 14) {
    <mat-form-field>
      <mat-label>{{'Bonuses.Regularity' | translate}}</mat-label>
      <mat-select [formControlName]="'Regularity'">
        @for (regularity of regularitys; track $index) {
        <mat-option [value]="regularity.Id">{{regularity.Name}}</mat-option>
        }
      </mat-select>
      @if(errorControl['Regularity']?.touched && errorControl['Regularity'].errors?.required) {
      <mat-error>
        {{'Bonuses.Regularity' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
    </mat-form-field>

    <mat-form-field>
      <mat-label>{{'Bonuses.DayOfWeek' | translate}}</mat-label>
      <mat-select [formControlName]="'DayOfWeek'">
        @for (day of days; track $index) {
        <mat-option [value]="day.Id">{{day.Name}}</mat-option>
        }
      </mat-select>
      @if(errorControl['DayOfWeek']?.touched && errorControl['DayOfWeek'].errors?.required) {
      <mat-error>
        {{'Bonuses.DayOfWeek' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
    </mat-form-field>
    }


    <mat-form-field>
      <mat-label>{{'Bonuses.ReusingMaxCountInPeriod' | translate}}</mat-label>
      <input matInput type="number" [placeholder]="'Bonuses.ReusingMaxCountInPeriod' | translate"
        [formControlName]="'ReusingMaxCountInPeriod'">
      @if(errorControl['ReusingMaxCountInPeriod']?.touched && errorControl['ReusingMaxCountInPeriod'].errors?.required)
      {
      <mat-error>
        {{'Bonuses.ReusingMaxCountInPeriod' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
    </mat-form-field>
    }

    <div class="calendar-content">
      <div class="calendar-picker">
        <app-date-time-picker formControlName="StartTime"></app-date-time-picker>
      </div>

      <div class="calendar-picker field-content-seccond-child">
        <app-date-time-picker formControlName="FinishTime"></app-date-time-picker>
      </div>
    </div>

    <div class="field-content">
      @if(bonusTypeId == 1 || bonusTypeId == 3) {
      <mat-form-field>
        <mat-label>{{'Bonuses.PeriodInHours' | translate}}</mat-label>
        <input matInput type="number" [placeholder]="'Bonuses.PeriodInHours' | translate" [formControlName]="'Period'"
          [required]="bonusTypeId == 1 || bonusTypeId == 3">
        @if(errorControl['Period']?.touched && errorControl['Period'].errors?.required) {
        <mat-error>
          {{'Bonuses.PeriodInHours' | translate}} {{'Errors.Required' | translate}}
        </mat-error>
        }
      </mat-form-field>
      }

      @if(bonusTypeId == 7 || bonusTypeId == 9) {
      <mat-form-field class="field-content-seccond-child">
        <mat-label>{{'Bonuses.PromoCode' | translate}}</mat-label>
        <input matInput type="text" [placeholder]="'Bonuses.PromoCode' | translate" [formControlName]="'PromoCode'">
      </mat-form-field>
      }
    </div>

    @if(bonusTypeId == 5) {
    <mat-form-field>
      <mat-label>{{'Clients.Amount' | translate}}</mat-label>
      <input matInput type="number" min="0" [placeholder]="'Clients.Amount' | translate"
        [formControlName]="'MinAmount'">
      @if(errorControl['MinAmount']?.touched && errorControl['MinAmount'].errors?.required) {
      <mat-error>
        {{'Clients.Amount' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
      @if(errorControl['MinAmount']?.touched && errorControl['MinAmount'].errors?.min) {
      <mat-error>
        {{'Bonuses.BonusWinMinAmount' | translate}} {{'Errors.PositiveNumbers' | translate}}
      </mat-error>
      }
    </mat-form-field>
    }

    @if(bonusTypeId != 14 && bonusTypeId != 5) {
    <div class="field-content">
      <mat-form-field>
        <mat-label>{{'Bonuses.BonusWinMinAmount' | translate}}</mat-label>
        <input matInput type="number" min="0" [placeholder]="'Bonuses.BonusWinMinAmount' | translate"
          [formControlName]="'MinAmount'">
        @if(errorControl['MinAmount']?.touched && errorControl['MinAmount'].errors?.required) {
        <mat-error>
          {{'Bonuses.BonusWinMinAmount' | translate}} {{'Errors.Required' | translate}}
        </mat-error>
        }
        @if(errorControl['MinAmount']?.touched && errorControl['MinAmount'].errors?.min) {
        <mat-error>
          {{'Bonuses.BonusWinMinAmount' | translate}} {{'Errors.PositiveNumbers' | translate}}
        </mat-error>
        }
      </mat-form-field>

      <mat-form-field class="field-content-seccond-child">
        <mat-label>{{'Bonuses.BonusWinMaxAmount' | translate}}</mat-label>
        <input matInput type="number" min="0" [placeholder]="'Bonuses.BonusWinMaxAmount' | translate"
          [formControlName]="'MaxAmount'">
        @if(errorControl['MaxAmount']?.touched && errorControl['MaxAmount'].errors?.required) {
        <mat-error>
          {{'Bonuses.BonusWinMaxAmount' | translate}} {{'Errors.Required' | translate}}
        </mat-error>
        }
        @if(errorControl['MaxAmount']?.touched && errorControl['MaxAmount'].errors?.min) {
        <mat-error>
          {{'Bonuses.BonusWinMinAmount' | translate}} {{'Errors.PositiveNumbers' | translate}}
        </mat-error>
        }
      </mat-form-field>
    </div>
    }

    <mat-form-field>
      <mat-label>{{'Bonuses.Description' | translate}}</mat-label>
      <input matInput type="text" [placeholder]="'Bonuses.Description' | translate" [formControlName]="'Description'">
    </mat-form-field>

    <mat-form-field>
      <mat-label>{{'Common.Status' | translate}}</mat-label>
      <mat-select [formControlName]="'Status'" required>
        @for (state of status; track $index) {
        <mat-option [value]="state.Id">{{state.Name}}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <!-- <mat-checkbox [formControlName]="'Status'">{{'Bonuses.Active' | translate}}</mat-checkbox> -->
    @if(bonusTypeId == 12) {
    <mat-checkbox [formControlName]="'AllowSplit'">{{'Bonuses.AllowSplit' | translate}}</mat-checkbox>
    }
    @if(bonusTypeId == 12) {
    <mat-checkbox [formControlName]="'RefundRollbacked'">{{'Bonuses.ReturnOnRefund' |translate}}</mat-checkbox>
    }
    @if(bonusTypeId == 10 || bonusTypeId == 11 || bonusTypeId == 12 || bonusTypeId == 13) {
    <mat-checkbox [formControlName]="'ResetOnWithdraw'">{{'Bonuses.ResetOnWithdraw' | translate}}</mat-checkbox>
    }
    @if(bonusTypeId == 10 || bonusTypeId == 13) {
    <mat-checkbox [formControlName]="'LinkedCampaign'">{{'Bonuses.LinkedCampaign' | translate}}</mat-checkbox>
    }
    @if(bonusTypeId == 10 || bonusTypeId == 13) {
    <mat-checkbox [formControlName]="'FreezeBonusBalance'">{{'Bonuses.FreezeBonusBalance' | translate}}</mat-checkbox>
    }
    <mat-form-field>
      <mat-label>{{'Bonuses.MaxGranted' | translate}}</mat-label>
      <input matInput type="number" [placeholder]="'Bonuses.MaxGranted' | translate" [formControlName]="'MaxGranted'">
    </mat-form-field>
    <mat-form-field>
      <mat-label>{{'Bonuses.MaxReceiversCount' | translate}}</mat-label>
      <input matInput type="number" [placeholder]="'Bonuses.MaxReceiversCount' | translate"
        [formControlName]="'MaxReceiversCount'">
    </mat-form-field>
    @if(bonusTypeId == 6 || bonusTypeId == 7 || bonusTypeId == 9 || bonusTypeId == 10 || bonusTypeId == 13) {
    <mat-form-field>
      <mat-label>{{'Bonuses.TurnoverCount' | translate}}</mat-label>
      <input matInput type="number" min="0" [placeholder]="'Bonuses.TurnoverCount' | translate"
        [formControlName]="'TurnoverCount'" required>
      @if(errorControl['TurnoverCount']?.touched && errorControl['TurnoverCount'].errors?.required) {
      <mat-error>
        {{'Bonuses.TurnoverCount' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
      @if(errorControl['TurnoverCount']?.touched && errorControl['TurnoverCount'].errors?.min) {
      <mat-error>
        {{'Bonuses.TurnoverCount' | translate}} {{'Errors.PositiveNumbers' | translate}}
      </mat-error>
      }
    </mat-form-field>
    }
    @if(bonusTypeId == 1) {
    <mat-form-field>
      <mat-label>{{'Bonuses.LinkedBonusId' | translate}}</mat-label>
      <input matInput type="number" [placeholder]="'Bonuses.LinkedBonusId' | translate"
        [formControlName]="'LinkedBonusId'">
    </mat-form-field>
    <mat-form-field>
      <mat-label>{{'Bonuses.AutoApproveMaxAmount' | translate}}</mat-label>
      <input matInput type="number" min="0" [placeholder]="'Bonuses.AutoApproveMaxAmount' | translate"
        [formControlName]="'AutoApproveMaxAmount'" required>
      @if(errorControl['AutoApproveMaxAmount']?.touched && errorControl['AutoApproveMaxAmount'].errors?.required) {
      <mat-error>
        {{'Bonuses.AutoApproveMaxAmount' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
      @if(errorControl['TurnoverCount']?.touched && errorControl['TurnoverCount'].errors?.min) {
      <mat-error>
        {{'Bonuses.AutoApproveMaxAmount' | translate}} {{'Errors.PositiveNumbers' | translate}}
      </mat-error>
      }
    </mat-form-field>
    }
    @if(bonusTypeId == 3 || bonusTypeId == 6 || bonusTypeId == 5) {
    <mat-form-field>
      <mat-label>{{'Bonuses.Percent' | translate}}</mat-label>
      <input matInput type="number" min="0" [placeholder]="'Bonuses.Percent' | translate" [formControlName]="'Percent'"
        required>
      @if(errorControl['Percent']?.touched && errorControl['Percent'].errors?.required) {
      <mat-error>
        {{'Bonuses.Percent' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
      @if(errorControl['Percent']?.touched && errorControl['Percent'].errors?.min) {
      <mat-error>
        {{'Bonuses.Percent' | translate}} {{'Errors.PositiveNumbers' | translate}}
      </mat-error>
      }
    </mat-form-field>
    }
    @if(bonusTypeId == 10 || bonusTypeId == 13) {
    <mat-form-field>
      <mat-label>{{'Bonuses.PercentFromBonusAmount' | translate}}</mat-label>
      <input matInput type="number" [placeholder]="'Bonuses.PercentFromBonusAmount' | translate"
        [formControlName]="'Percent'">
    </mat-form-field>
    }
    @if(bonusTypeId == 5) {
    <mat-form-field class="example-chip-list">
      <mat-label>{{"Common.AddCount" | translate}}</mat-label>
      <mat-chip-grid #chipGrid aria-label="Enter count">
        @for (countCtrl of countsArray.controls; track countCtrl; let index = $index) {
        <mat-chip-row (removed)="remove(countCtrl.value)" [editable]="true"
          [aria-description]="'press enter to edit ' + countCtrl.value">
          {{countCtrl.value}}
          <button matChipRemove [attr.aria-label]="'remove ' + countCtrl.value">
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip-row>
        }
        <input placeholder="the sum of counts must be equal to 100" [matChipInputFor]="chipGrid"
          [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
          (matChipInputTokenEnd)="add($event)">
      </mat-chip-grid>
      @if(countsArray.errors?.sumNotEqual100) {
      <div style="color: red;">
        {{"Errors.TheSumOfCountsMustBeEqualTo100" | translate}}
      </div>
      }
      @if (countsArray.errors?.pattern) {
      <div style="color: red;">
        {{"Errors.OnlyNumbersAreAllowed" | translate}}.
      </div>
      }
    </mat-form-field>
    } @else if (bonusTypeId == 4) {
      <!-- <div class="field-row"> -->

        <app-campaign-selector
          [campaignTypes]="campaignTypes"
          [campaigns]="campaigns"
          [selectedCampaignIds]="selectedCampaignIds"
          (typeChange)="onTypeChange($event)"
          (campaignChange)="onCampaignChange($event)"
          (valueAdded)="handleValueAdded($event)"
      ></app-campaign-selector>


    <div class="selected-items-area">
      @for ( info of infoArray.controls; track $index) {
      <div class="selected-currency">
        <span>{{ info.value.BonusId | IdToName: allBounuses }} - {{ info.value.Periodicity }}</span>
        <button mat-icon-button color="warn" (click)="removeValue($index)">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      }
    </div>
    @if (infoArray.errors?.minSelectedItems) {
      <mat-error>
        {{ 'Common.Info' | translate }} {{"Errors.MustHaveAtLeast" | translate}} 3 {{"Common.Items" | translate}}.
      </mat-error>
    }

    } @else if ( bonusTypeId == 5 || bonusTypeId == 9) {
    <mat-form-field>
      <mat-label>{{'Common.Info' | translate}}</mat-label>
      <input matInput type="text" [placeholder]="'Common.Info' | translate" [formControlName]="'Info'">
    </mat-form-field>
    }
    @if(bonusTypeId == 6 || bonusTypeId == 9) {
    <mat-form-field>
      <mat-label>{{'Bonuses.Sequence' | translate}}</mat-label>
      <input matInput type="text" [placeholder]="'Bonuses.Sequence' | translate" [formControlName]="'Sequence'">
    </mat-form-field>
    }

    @if(bonusTypeId == 10 || bonusTypeId == 13 || bonusTypeId == 4) {
    <mat-form-field>
      <mat-label>{{'Bonuses.Priority' | translate}}</mat-label>
      <input matInput type="number" min="0" [placeholder]="'Priority'" [formControlName]="'Priority'" required>
      @if(errorControl['Priority']?.touched && errorControl['Priority'].errors?.required) {
      <mat-error>
        {{'Bonuses.Priority' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
      @if(errorControl['Priority']?.touched && errorControl['Priority'].errors?.min) {
      <mat-error>
        {{'Bonuses.Priority' | translate}} {{'Errors.PositiveNumbers' | translate}}
      </mat-error>
      }
    </mat-form-field>
    }

    @if(bonusTypeId >= 10 && bonusTypeId <= 14 || bonusTypeId==4 || bonusTypeId==1) { <mat-form-field>
      <mat-label>{{'Bonuses.ValidForAwarding' | translate}}</mat-label>
      <input matInput type="number" min="0" [placeholder]="'Bonuses.ValidForAwarding' | translate"
        [formControlName]="'ValidForAwarding'" [required]="bonusTypeId >= 10 && bonusTypeId <= 14 || bonusTypeId == 4">
      @if(errorControl['ValidForAwarding']?.touched && errorControl['ValidForAwarding'].errors?.required) {
      <mat-error>
        {{'Bonuses.ValidForAwarding' | translate}} {{'Errors.Required' | translate}}
      </mat-error>
      }
      @if(errorControl['ValidForAwarding']?.touched && errorControl['ValidForAwarding'].errors?.min) {
      <mat-error>
        {{'Bonuses.ValidForAwarding' | translate}} {{'Errors.PositiveNumbers' | translate}}
      </mat-error>
      }
      </mat-form-field>

      <mat-form-field>
        <mat-label>{{'Bonuses.ValidForSpending' | translate}}</mat-label>
        <input matInput type="number" min="0" [placeholder]="'Bonuses.ValidForSpending' | translate"
          [formControlName]="'ValidForSpending'" required>
        @if(errorControl['ValidForSpending']?.touched && errorControl['ValidForSpending'].errors?.required) {
        <mat-error>
          {{'Bonuses.ValidForAwarding' | translate}} {{'Errors.Required' | translate}}
        </mat-error>
        }
        @if(errorControl['ValidForSpending']?.touched && errorControl['ValidForSpending'].errors?.min) {
        <mat-error>
          {{'Bonuses.ValidForAwarding' | translate}} {{'Errors.PositiveNumbers' | translate}}
        </mat-error>
        }
      </mat-form-field>
      }
      @if(bonusTypeId == 10 || bonusTypeId == 11 || bonusTypeId == 12 || bonusTypeId == 13 || bonusTypeId == 4) {
      <mat-form-field>
        <mat-label>{{'Bonuses.ReusingMaxCount' | translate}}</mat-label>
        <input matInput type="number" [placeholder]="'Bonuses.ReusingMaxCount' | translate"
          [formControlName]="'ReusingMaxCount'">
      </mat-form-field>
      }

      <div class="color-row">
        <mat-label>{{ 'Sport.Color' | translate }}</mat-label>
        
        <input type="color" class="color-input" [(ngModel)]="color" [formControlName]="'Color'"/>
        
        <div [style.background]="color" class="color-preview"></div>
      </div>

  </form>

  @if(bonusTypeId == 12 || bonusTypeId == 13 || bonusTypeId == 10) {
  <div class="additionally">
    <mat-form-field>
      <mat-label>{{'Bonuses.SelectType' | translate}}</mat-label>
      <mat-select (selectionChange)="addedConditions.selectedGroupType = $event.value">
        @for (name of addedConditions.groupTypes; track $index) {
        <mat-option [value]="name.Id">{{name.Name}}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    @for (condition of addedConditions.conditions; track condition; let index = $index) {
    <div class="condition-list">
      <div>{{condition?.Condition?.Name}}</div>
      <div>{{condition?.ConditionType?.NickName}}</div>
      <div>{{condition?.ConditionValue}}</div>
      <mat-icon (click)="removeCondition(addedConditions, index)">close</mat-icon>
    </div>
    }
    <div class="condition-action">
      <div class="selection-action">
        <mat-form-field>
          <mat-label>{{'Bonuses.SelectCondition' | translate}}</mat-label>
          <mat-select [ngModel]="addedConditions.selectedCondition"
            (selectionChange)="addedConditions.selectedCondition = $event.value">
            @for (name of conditions; track $index) {
            <mat-option [value]="name">{{name.Name}}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-form-field>
          <mat-label>{{'Bonuses.SelectOperation' | translate}}</mat-label>
          <mat-select [ngModel]="addedConditions.selectedConditionType"
            (selectionChange)="addedConditions.selectedConditionType = $event.value">
            @for (name of conditionTypes; track $index) {
            <mat-option [value]="name">{{name.NickName}}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-form-field class="value-field">
          <mat-label>{{'Bonuses.Value' | translate}}</mat-label>
          <input matInput type="text" [placeholder]="'Bonuses.Value' | translate"
            [ngModel]="addedConditions.selectedConditionValue"
            (ngModelChange)="this.addedConditions.selectedConditionValue = $event">
        </mat-form-field>
      </div>

      <div class="btn-action">
        <button mat-stroked-button class="mat-btn" (click)="addCondition(addedConditions)"
          [class.disabled]="!addedConditions.selectedCondition || !addedConditions.selectedConditionType || !this.addedConditions.selectedConditionValue">
          {{'Common.Add' | translate}}
        </button>
        <button mat-stroked-button class="mat-btn" (click)="addGroup(addedConditions)">{{'Bonuses.AddGroup' |
          translate}}</button>
      </div>

    </div>

    @for (group of addedConditions.groups; track group; let index = $index) {
    <div class="group-container">
      <mat-form-field>
        <mat-label>{{'Bonuses.SelectType' | translate}}</mat-label>
        <mat-select [ngModel]="group.selectedGroupType" (selectionChange)="group.selectedGroupType = $event.value">
          @for (groupType of group.groupTypes; track $index) {
          <mat-option [value]="groupType.Id">{{groupType.Name}}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      @for (condition of group.conditions; track $index) {
      <div class="condition-list">
        <div>{{condition.Condition.Name}}</div>
        <div>{{condition.ConditionType.NickName}}</div>
        <div>{{condition.ConditionValue}}</div>
        <mat-icon (click)="removeCondition(group, index)">close</mat-icon>
      </div>
      }

      <div class="condition-action">

        <div class="selection-action">
          <mat-form-field>
            <mat-label>{{'Bonuses.SelectCondition' | translate}}</mat-label>
            <mat-select [ngModel]="group.selectedCondition" (selectionChange)="group.selectedCondition = $event.value">
              <mat-option value="" disabled>{{'Bonuses.SelectCondition' | translate}}</mat-option>
              @for (condition of conditions; track $index) {
              <mat-option [value]="condition">{{condition.Name}}</mat-option>
              }
            </mat-select>
          </mat-form-field>
          <mat-form-field>
            <mat-label>{{'Bonuses.SelectOperation' | translate}}</mat-label>
            <mat-select [ngModel]="group.selectedConditionType"
              (selectionChange)="group.selectedConditionType = $event.value">
              <mat-option value="" disabled>{{'Bonuses.SelectOperation' | translate}}</mat-option>
              @for (conditionType of conditionTypes; track $index) {
              <mat-option [value]="conditionType">{{conditionType.NickName}}</mat-option>
              }
            </mat-select>
          </mat-form-field>
          <mat-form-field class="value-field">
            <input matInput [placeholder]="'Value'" [ngModel]="group.selectedConditionValue"
              (ngModelChange)="group.selectedConditionValue = $event">
          </mat-form-field>

        </div>

        <div class="btn-action">
          <button mat-stroked-button class="mat-btn" (click)="addCondition(group)"
            [class.disabled]="!group.selectedCondition || !group.selectedConditionType || !group.selectedConditionValue">{{'Common.Add'
            | translate}}
          </button>
          <button mat-stroked-button class="mat-btn" (click)="addGroup(group)">{{'Bonuses.AddGroup' |
            translate}}</button>
          <button mat-stroked-button class="mat-btn"
            (click)="removeGroup(addedConditions, index)">{{'Bonuses.RemoveGroup' |
            translate}}</button>
        </div>

      </div>
      @for (subgroup of group.groups; track $index) {
      <div class="sub-group-container">
        <mat-form-field>
          <mat-label>Select</mat-label>
          <mat-select [ngModel]="subgroup.selectedGroupType"
            (selectionChange)="subgroup.selectedGroupType = $event.value">
            @for (groupType of subgroup.groupTypes; track $index) {
            <mat-option [value]="groupType.Id">{{groupType.Name}}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        @for (condition of subgroup.conditions; track condition; let i = $index) {
        <div class="condition-list">
          <div>{{condition.Condition.Name}}</div>
          <div>{{condition.ConditionType.NickName}}</div>
          <div>{{condition.ConditionValue}}</div>
          <mat-icon style="cursor: pointer" (click)="removeCondition(subgroup, i)">close</mat-icon>
        </div>
        }

        <div class="condition-action">
          <div class="selection-action">
            <mat-form-field>
              <mat-label>{{'Bonuses.SelectCondition' | translate}}</mat-label>
              <mat-select [ngModel]="subgroup.selectedCondition"
                (selectionChange)="subgroup.selectedCondition = $event.value">
                <mat-option value="" disabled>{{'Bonuses.SelectCondition' | translate}}</mat-option>
                @for (condition of conditions; track $index) {
                <mat-option [value]="condition">{{condition.Name}}</mat-option>
                }
              </mat-select>
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{'Bonuses.SelectOperation' | translate}}</mat-label>
              <mat-select [ngModel]="subgroup.selectedConditionType"
                (selectionChange)="subgroup.selectedConditionType = $event.value">
                <mat-option value="" disabled>{{'Bonuses.SelectOperation' | translate}}</mat-option>
                @for (conditionType of conditionTypes; track $index) {
                <mat-option [value]="conditionType">{{conditionType.NickName}}</mat-option>
                }
              </mat-select>
            </mat-form-field>
            <mat-form-field class="value-field">
              <input matInput [placeholder]="'Value'" [ngModel]="subgroup.selectedConditionValue"
                (ngModelChange)="subgroup.selectedConditionValue = $event">
            </mat-form-field>
          </div>
          <div class="btn-action">
            <button mat-stroked-button class="mat-btn" (click)="addCondition(subgroup)"
              [class.disabled]="!subgroup.selectedCondition || !subgroup.selectedConditionType || !subgroup.selectedConditionValue">{{'Common.Add'
              | translate}}
            </button>
            <button mat-stroked-button class="mat-btn" (click)="removeGroup(group, index)">{{'Bonuses.RemoveGroup' |
              translate}}</button>
          </div>
        </div>
      </div>
      }
    </div>
    }

  </div>
  }

</div>

<div mat-dialog-actions>
  <button mat-raised-button class="modal-cancel-btn" (click)="close()">{{'Common.Cancel' | translate}}</button>
  <button mat-raised-button class="modal-primary-btn" [class.disabled]="formGroup.invalid || isSendingRequest"
    (click)="onSubmit()">
    {{'Common.Create'| translate}}
  </button>
</div>